<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="shortcut icon" href="../img/logo.ico">
<title>Modificar Producto </title>
<link rel="stylesheet" href="../css/admin.css">
</head>
    <body>
        <header>
            <nav class="navbar-panel ">
                <a href="../index.html">Ir a la tienda</a>
                <a href="lista-productos.html">Ver inventario</a>
                <a href="agregar-producto.html">Agregar producto</a>
                <a href="ver-producto.html">Ver producto</a>
                <a href="editar-eliminar-producto.html">Editar/Eliminar producto</a>
                <a href="ver-mensajes.html">Mensajes</a>

            </nav>
        </header>
        <div class="logo-centrado">
            <img src="../img/logo.png" alt="logo" width="150">
        </div>
        <h1>Modificar Productos del Inventario</h1><br>

        
        <div id="app">


           
            <div id="datos-producto">
                <h2>Datos del Producto</h2>
                
                <div id="datos-actuales">
                    <!-- Acá se cargan los datos actuales del producto, se obtienen con el codigo de producto que fue 
                    pasado como parametro en la url desde la pagina anterior-->
                </div>
                
                <form id="form-guardar-cambios">
                    <label for="descripcion">Descripción:</label>
                    <input type="text" id="descripcionModificar" name="descripcion" required><br>

                    <label for="cantidad">Stock disponible:</label>
                    <input type="number" id="cantidadModificar" name="cantidad" required><br>

                    <label for="precio">Precio:</label>
                    <input type="number" step="0.01" id="precioModificar" name="precio" required><br>

                    <!-- Imagen actual del producto - Debe comentarse al subirse al servidor-->

                    <img id="imagen-actual" style="max-width: 200px; display: none;">

                    <!-- Vista previa de la nueva imagen seleccionada -->
                    <img id="imagen-vista-previa" style="max-width: 200px; display: none;">

                    <!-- Input para nueva imagen -->
                    <label for="imagen">Nueva Imagen:</label>
                    <input type="file" id="nuevaImagen" name="imagen"><br>
                    <br>
                    <label for="categoria">Categoria:</label>
                    <input type="number" id="catModificar" name="categoria" required><br>
                    <button type="submit">Guardar Cambios</button>
                    <a class="editar" href="editar-eliminar-productos.html">Cancelar</a>
                </form>
            </div>
        </div>
        <script>

            

            const URL = "https://JuanjoPatti.pythonanywhere.com/"
            
           
            //?cod=x es la cadena que contiene el parametro en la url
            const paramUrl = window.location.search
            
            //cortamos la cadena que contiene el parametro de la url y la convertimos en un array donde el indice "1" es el valor que necesitamos
            codProd = paramUrl.split("=")

            //Acá guardamos el parametro en una variable y de esta forma ya podemos usarlo para hacer las consultas a la base de datos
            var codigo = parseInt(codProd[1])
           
            
           
            fetch(URL + 'productos/' + codigo)
            .then(response => {
                if (response.ok) {
                    
                    return response.json()
                } else {
                    throw new Error('Error al obtener los datos del producto.')

                }
            })

            .then(function(data){
                
                lista=
                    '<ul>' +
                        '<li><img src=https://www.pythonanywhere.com/user/JuanjoPatti/files/home/JuanjoPatti/mysite/static/imagenes/' + data.imagen_url + ' alt="Imagen del producto"></li>'+
                        '<li>Nombre d ela imagen: ' + data.imagen_url + '</li>' +
                        '<li>Descripcion: ' + data.descripcion + '</li>' +
                        '<li>Precio: ' + data.precio + '</li>' +
                        '<li> Stock disponible: ' + data.cantidad + '</li>'+
                        '<li> Categoría ' + data.categoria + '</li>'+
                    '</ul>'
                document.getElementById('datos-actuales').innerHTML=lista;

                document.getElementById('descripcionModificar').value=data.descripcion
                document.getElementById('precioModificar').value=data.precio
                document.getElementById('cantidadModificar').value=data.cantidad
                document.getElementById('nuevaImagen').value=data.imagen_url
                document.getElementById('catModificar').value=data.categoria  
            })

            document.getElementById("form-guardar-cambios").addEventListener('submit', function(event){
                event.preventDefault()
                var formData = new FormData(this);

                fetch(URL + 'productos/' + codigo, {
                    method: 'PUT',body: formData})

                    .then(function (response) {
                        if (response.ok) {
                            
        
                            return response.json();
                        }else {
                       
                            throw new Error('Error al midificar el producto.');
                        }
                    })
                    .then(function (data) {
                        alert('Producto actualizado correctamente.');

                        fetch(URL + 'productos/' + codigo)
                        .then(response => {
                            if (response.ok) {
                                
                                return response.json()
                            } else {
                                throw new Error('Error al obtener los datos del producto.')
    
                            }
                        })
    
                        .then(function(data){
                            
                            lista=
                                '<ul>' +
                                    '<li><img src=https://www.pythonanywhere.com/user/JuanjoPatti/files/home/JuanjoPatti/mysite/static/imagenes/' + data.imagen_url + ' alt="Imagen del producto"></li>'+
                                    '<li>Nombre d ela imagen: ' + data.imagen_url + '</li>' +
                                    '<li>Descripcion: ' + data.descripcion + '</li>' +
                                    '<li>Precio: ' + data.precio + '</li>' +
                                    '<li> Stock disponible: ' + data.cantidad + '</li>'+
                                    '<li> Categoría ' + data.categoria + '</li>'+
                                '</ul>'
                            document.getElementById('datos-actuales').innerHTML=lista;
    
                            document.getElementById('descripcionModificar').value=data.descripcion
                            document.getElementById('precioModificar').value=data.precio
                            document.getElementById('cantidadModificar').value=data.cantidad
                            document.getElementById('nuevaImagen').value=data.imagen_url
                            document.getElementById('catModificar').value=data.categoria  
                        })
                         
                    })
        
                    .catch(function (error) {
                        alert('Error al actualizar el producto. 2');
                    })

                   


                    
        
                
            })
            
        </script>
        <footer><p>Trabajo Práctico integrador - Codo a Codo 2024</p></footer>
</body>
</html>
